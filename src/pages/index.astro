---
import Welcome from '../components/Welcome.astro';
import Layout from '../layouts/Layout.astro';

const postFiles = await import.meta.glob('./work/*.astro', { eager: true });

const posts = Object.entries(postFiles)
  .map(([path, post]) => {
    const frontmatter = post.frontmatter || {};
    return {
      url: path.replace('./', '/').replace('.astro', ''),
      ...frontmatter,
    };
  })

  .filter(post => post.title)

  .sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate))

  .slice(0, 3);
---

<Layout>
  <main class="main-index">
    <header class="introduction">
      <h1 class="main-title">The Sushil's Desk</h1>
      <p>Hello! Welcome to my blog, where I journal what I learn, build, and explore as I work toward landing my first role in tech.</p>
      <p>My name is Sushil â€” let's get this started! Check out the latest posts below, or click "View All Posts" to see them all.
      </p>
    </header>

    <section class="latest-posts">
      <h2 class="section-title">Latest Posts</h2>

      {posts.length === 0 ? (
        <p>Coming soon...</p>
      ) : (
        <div class="post-grid">
          {posts.map(post => (
            <article class="post-card">
              <h3 class="index-subheading"><a href={post.url}>{post.title}</a></h3>
              <small>{post.pubDate}</small>
              <p class="post-description">{post.description}</p>
              <a class="read-more" href={post.url}>Read More</a>
            </article>
          ))}
        </div>
      )}

      <a href="/work" class="view-posts">View all posts</a>
    </section>
  </main>
</Layout>
